import React, { useEffect, useRef } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { resetTyping, typeHeadingChar, typeSubheadingChar } from '../../store/typingSlice';
import './start-page.styles.css';

function StartPage() {
    const dispatch = useDispatch();
    const { headingText, subheadingText, typedHeading, typedSubheading } = useSelector((state) => state.typing);

    // Use a ref to store the latest typedHeading and typedSubheading
    const typedStateRef = useRef({ typedHeading, typedSubheading });

    useEffect(() => {
        typedStateRef.current = { typedHeading, typedSubheading };
    }, [typedHeading, typedSubheading]);

    // Combined effect for typing the heading and then the subheading
    useEffect(() => {
        dispatch(resetTyping()); // Reset typing state on component mount

        let hIntervalId;
        let sIntervalId;

        const startTypingHeading = () => {
            hIntervalId = setInterval(() => {
                // Access latest typedHeading from ref
                if (typedStateRef.current.typedHeading.length < headingText.length) {
                    dispatch(typeHeadingChar());
                } else {
                    clearInterval(hIntervalId);
                    // Delay before starting subheading typing
                    setTimeout(() => {
                        startTypingSubheading();
                    }, 500); // Small delay after heading is done
                }
            }, 100); // Typing speed for heading
        };

        const startTypingSubheading = () => {
            sIntervalId = setInterval(() => {
                // Access latest typedSubheading from ref
                if (typedStateRef.current.typedSubheading.length < subheadingText.length) {
                    dispatch(typeSubheadingChar());
                } else {
                    clearInterval(sIntervalId);
                }
            }, 70); // Typing speed for subheading
        };

        startTypingHeading();

        return () => {
            clearInterval(hIntervalId);
            clearInterval(sIntervalId);
        };
    }, [dispatch, headingText, subheadingText]);

    return (
       <div className='heart-container'>
         <div className="typing-content">
           <h1 className="typing-heading">{typedHeading}</h1>
           <h2 className="typing-subheading">{typedSubheading}</h2>
         </div>
         <div id="heart">
           <div className='compass'>
              <svg 
                xmlns="http://www.w3.org/2000/svg" 
                xmlSpace="preserve" 
                width="2048" 
                height="2048" 
                style={{
                  shapeRendering: 'geometricPrecision',
                  textRendering: 'geometricPrecision',
                  imageRendering: 'optimizeQuality',
                  fillRule: 'evenodd',
                  clipRule: 'evenodd'
                }}
                viewBox="0 0 2048 2048"
              >
                <defs>
                  <style>{`.fil14{fill:#414141}.fil13{fill:#353535;fill-rule:nonzero}`}</style>
                </defs>
                <g id="Layer_x0020_1">
                <path d="M1273.27 536.217c39.575 16.426 77.28 36.716 112.648 60.402a659.078 659.078 0 0 1 86.757 69.347l.211-.22 12.226 12.228c30.067 30.074 57.316 63.252 81.268 99.058 23.663 35.375 43.948 73.114 60.387 112.753a648.351 648.351 0 0 1 37.07 122.1c8.183 41.187 12.475 83.695 12.475 127.114 0 43.421-4.292 85.931-12.476 127.125a648.453 648.453 0 0 1-37.076 122.104c-16.442 39.64-36.73 77.383-60.393 112.756-23.955 35.805-51.204 68.983-81.273 99.053-30.068 30.069-63.243 57.32-99.048 81.276-35.372 23.664-73.112 43.952-112.752 60.395a648.112 648.112 0 0 1-122.095 37.078c-41.19 8.185-83.7 12.477-127.12 12.477-43.409 0-85.91-4.293-127.095-12.479a648.43 648.43 0 0 1-122.092-37.081c-39.585-16.424-77.29-36.7-112.652-60.371-35.782-23.95-68.96-51.206-99.055-81.292l-.06-.025a656.754 656.754 0 0 1-81.407-99.091c-23.68-35.375-43.983-73.12-60.44-112.763a647.945 647.945 0 0 1-37.107-122.081c-8.19-41.18-12.486-83.676-12.486-127.08 0-43.439 4.293-85.963 12.477-127.167a648.461 648.461 0 0 1 37.08-122.13c16.444-39.648 36.733-77.395 60.401-112.773 23.956-35.81 51.21-68.99 81.283-99.06 30.075-30.075 63.257-57.327 99.068-81.283 35.38-23.666 73.128-43.954 112.779-60.396a648.56 648.56 0 0 1 122.136-37.079c41.206-8.185 83.733-12.478 127.172-12.478 43.409 0 85.912 4.297 127.097 12.485a648.178 648.178 0 0 1 122.093 37.099zm93.78 88.569a616.902 616.902 0 0 0-106.8-57.212 613.607 613.607 0 0 0-115.583-35.106c-38.992-7.753-79.316-11.82-120.587-11.82-41.304 0-81.65 4.064-120.662 11.813a613.971 613.971 0 0 0-115.626 35.086 618.259 618.259 0 0 0-106.931 57.207c-33.669 22.522-65.116 48.395-93.885 77.165-28.77 28.768-54.644 60.212-77.166 93.877a618.298 618.298 0 0 0-57.212 106.926 613.836 613.836 0 0 0-35.087 115.62c-7.748 39.008-11.812 79.353-11.812 120.656 0 41.266 4.068 81.584 11.822 120.57a613.382 613.382 0 0 0 35.114 115.57 618.371 618.371 0 0 0 57.252 106.917 622.405 622.405 0 0 0 77.033 93.79l.29.119c28.8 28.794 60.251 54.678 93.897 77.199a617.242 617.242 0 0 0 106.805 57.18 613.762 613.762 0 0 0 115.582 35.09c38.991 7.748 79.314 11.815 120.586 11.815 41.284 0 81.615-4.066 120.61-11.814a613.645 613.645 0 0 0 115.584-35.083 618.257 618.257 0 0 0 106.904-57.207c33.66-22.52 65.102-48.39 93.867-77.158 28.766-28.767 54.635-60.21 77.155-93.872a618.295 618.295 0 0 0 57.204-106.909 613.88 613.88 0 0 0 35.084-115.593c7.747-38.997 11.81-79.33 11.81-120.614 0-41.284-4.063-81.613-11.81-120.606a613.817 613.817 0 0 0-35.077-115.587 618.18 618.18 0 0 0-57.197-106.905c-20.743-31.008-44.33-60.134-70.4-87.02l-6.802-6.803c-28.833-28.834-60.306-54.749-93.961-77.291z" style={{fill: '#6a6a6a', fillRule: 'nonzero'}}/>
                  <path style={{fill: '#adadae'}} className="compass-needle-sw" d="m1073.91 1089.04 240.41 340.23-340.226-240.42z"/>
                  <path style={{fill: '#7d7d7d'}} className="compass-needle-sw" d="m974.094 1188.85-.42-.59-239.995-339.634 339.991 240.244.24.17z"/>
                  <path style={{fill: '#9c9c9d'}} className="compass-needle-ne" d="m1073.91 1089.04 240.41 340.23-.01-.01L1024 1138.95z"/>
                  <path style={{fill: '#707070'}} className="compass-needle-ne" d="m733.686 848.637-.007-.011 339.991 240.244.24.17-49.91 49.91z"/>
                  <path d="M1054.84 1169.79c-17.032 17.032-44.646 17.032-61.677 0-17.032-17.032-17.032-44.647 0-61.678 17.031-17.032 44.645-17.032 61.677 0 17.032 17.031 17.032 44.646 0 61.678z" style={{fill: '#5d5d5d'}}/>
                  <path d="M1041.97 1156.92c-9.924 9.924-26.013 9.924-35.936 0-9.923-9.922-9.923-26.013 0-35.935 9.923-9.924 26.012-9.924 35.936 0 9.922 9.922 9.922 26.013 0 35.935z" style={{fill: '#eaeaea'}}/>
                  <path className="fil13" d="M698.119 822.086a6.379 6.379 0 0 1 0-9.019 6.379 6.379 0 0 1 9.019 0l21.294 21.295a6.379 6.379 0 0 1 0 9.02 6.379 6.379 0 0 1-9.019 0l-21.294-21.296zM606.213 959.896a6.358 6.358 0 0 1 5.183-11.61l27.511 12.25a6.358 6.358 0 0 1 3.213 8.395 6.357 6.357 0 0 1-8.396 3.213l-27.511-12.248zM1436.61 948.287a6.358 6.358 0 0 1 5.183 11.61l-27.513 12.247a6.357 6.357 0 0 1-8.395-3.213 6.358 6.358 0 0 1 3.212-8.395l27.513-12.249zM1196.95 718.617a6.363 6.363 0 0 1 11.708 4.982l-11.849 27.686a6.362 6.362 0 1 1-11.708-4.98l11.849-27.688zM844.11 721.532a6.366 6.366 0 0 1 11.758-4.883l11.53 27.822a6.366 6.366 0 1 1-11.758 4.883l-11.53-27.822zM1340.86 813.067a6.379 6.379 0 0 1 9.019 0 6.379 6.379 0 0 1 0 9.019l-21.294 21.295a6.379 6.379 0 0 1-9.02 0 6.379 6.379 0 0 1 0-9.019l21.295-21.295zM1448.37 1145.33a6.378 6.378 0 1 1 0-12.755h30.116a6.377 6.377 0 1 1 0 12.755h-30.116zM1319.57 1443.53a6.379 6.379 0 0 1 0-9.019 6.379 6.379 0 0 1 9.019 0l21.294 21.295a6.379 6.379 0 0 1 0 9.02 6.38 6.38 0 0 1-9.019 0l-21.294-21.296zM1409.09 1317.36a6.357 6.357 0 0 1 5.183-11.608l27.511 12.247a6.357 6.357 0 0 1-5.183 11.608l-27.511-12.247zM633.723 1305.75a6.357 6.357 0 0 1 8.395 3.213 6.358 6.358 0 0 1-3.212 8.395l-27.512 12.25a6.358 6.358 0 0 1-8.395-3.214 6.358 6.358 0 0 1 3.213-8.395l27.511-12.249zM851.193 1526.61a6.364 6.364 0 0 1 8.346-3.364 6.364 6.364 0 0 1 3.362 8.346l-11.846 27.687a6.362 6.362 0 0 1-11.708-4.982l11.846-27.687zM1180.6 1533.43a6.366 6.366 0 0 1 11.76-4.883l11.529 27.82a6.366 6.366 0 1 1-11.758 4.883l-11.531-27.82zM719.412 1434.52a6.379 6.379 0 0 1 9.019 0 6.379 6.379 0 0 1 0 9.019l-21.294 21.295a6.38 6.38 0 0 1-9.02 0 6.379 6.379 0 0 1 0-9.019l21.295-21.295z"/>
                  <path className="fil14" d="M555.491 1097.34h24.944l8.989 47.49 13.105-47.49h24.886l13.166 47.49 8.988-47.49h24.827l-18.728 85.03H629.91l-14.907-53.54-14.849 53.54h-25.756zM986.298 1578.93l24.183-1.512c.517 3.925 1.589 6.912 3.197 8.98 2.605 3.332 6.358 4.978 11.22 4.978 3.62 0 6.415-.842 8.387-2.546 1.953-1.704 2.93-3.677 2.93-5.916 0-2.126-.919-4.04-2.796-5.726-1.876-1.684-6.203-3.274-13.02-4.767-11.143-2.509-19.09-5.822-23.838-9.977-4.786-4.154-7.18-9.44-7.18-15.873 0-4.23 1.224-8.233 3.676-11.985 2.451-3.754 6.127-6.702 11.048-8.866 4.92-2.145 11.66-3.216 20.219-3.216 10.511 0 18.535 1.952 24.05 5.858 5.514 3.906 8.788 10.13 9.841 18.65l-23.954 1.397c-.632-3.694-1.971-6.394-4.02-8.08-2.03-1.665-4.844-2.508-8.425-2.508-2.968 0-5.189.613-6.683 1.876-1.494 1.245-2.239 2.777-2.239 4.577 0 1.302.612 2.47 1.838 3.523 1.206 1.092 4.04 2.087 8.54 3.025 11.105 2.394 19.05 4.825 23.856 7.277 4.806 2.45 8.31 5.476 10.493 9.113 2.183 3.62 3.293 7.679 3.293 12.179 0 5.265-1.474 10.128-4.384 14.571-2.91 4.46-6.989 7.83-12.235 10.128-5.227 2.298-11.832 3.447-19.799 3.447-13.977 0-23.665-2.68-29.046-8.08-5.399-5.38-8.443-12.217-9.152-20.527zM1420.82 1097.34h70.4v18.15h-44.07v13.52h40.89v17.35h-40.89v16.75h45.36v19.26h-71.69zM985.915 670.355h24.545l32.02 47.04v-47.04h24.76v85.033h-24.76l-31.86-46.685v46.685h-24.705z"/>
                  <path d="M953.016 378.245h141.969c5.962 0 10.839 4.877 10.839 10.839v61.762c0 5.963-4.877 10.842-10.839 10.842H953.016c-5.962 0-10.839-4.88-10.839-10.842v-61.762c0-5.962 4.877-10.839 10.839-10.839z" style={{fill: '#6a6a6a'}}/>
                </g>
              </svg>
           </div>
         </div>
         <div className='button-container'>
                <button className='btn-default'> Choose destination through world map </button>
                <button className='btn-default'> Brain Storm Your Trip Plans </button>
         </div>
       </div>
    )
}

export default StartPage;